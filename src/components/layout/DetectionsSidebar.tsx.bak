import React, { useState } from "react";
import { SectionHeader, FilterControls } from "../ui";
import DetectionItem from "../ui/DetectionItem";
import type { FilterState } from "../ui/FilterControls";

export interface DetectionData {
  clusterId: string;
  coordinates: string;
  detectionInterval: string;
  objectsType: string;
  responsibleUAV: string;
  area: number; // Size in meters for map circle radius
  lat: number;
  lon: number;
}

// Export detection data for use in other components
export const allDetectionItems: DetectionData[] = [
  {
    clusterId: "Cluster 2248",
    coordinates: "Lat: 52.245 Lon: 21.035",
    detectionInterval: "13.02.2025 07:00 - 09:34",
    objectsType: "mixed",
    responsibleUAV: "20037 Mavic air",
    area: 150,
    lat: 52.245,
    lon: 21.035,
  },
  {
    clusterId: "Cluster 87443",
    coordinates: "Lat: 52.198 Lon: 20.945",
    detectionInterval: "13.02.2025 08:15 - 10:22",
    objectsType: "vehicle",
    responsibleUAV: "UAV 22456",
    area: 75,
    lat: 52.198,
    lon: 20.945,
  },
  {
    clusterId: "Cluster 5346",
    coordinates: "Lat: 52.267 Lon: 21.098",
    detectionInterval: "13.02.2025 06:45 - 08:12",
    objectsType: "personnel",
    responsibleUAV: "20037 Mavic air",
    area: 250,
    lat: 52.267,
    lon: 21.098,
  },
  {
    clusterId: "Cluster 3461",
    coordinates: "Lat: 52.189 Lon: 20.987",
    detectionInterval: "13.02.2025 09:30 - 11:45",
    objectsType: "unknown",
    responsibleUAV: "UAV 335663",
    area: 120,
    lat: 52.189,
    lon: 20.987,
  },
  {
    clusterId: "Cluster 2048",
    coordinates: "Lat: 52.278 Lon: 21.056",
    detectionInterval: "13.02.2025 10:15 - 12:30",
    objectsType: "mixed",
    responsibleUAV: "Kolibri 7",
    area: 90,
    lat: 52.278,
    lon: 21.056,
  },
  {
    clusterId: "Cluster 0048",
    coordinates: "Lat: 52.156 Lon: 20.934",
    detectionInterval: "13.02.2025 05:20 - 07:45",
    objectsType: "vehicle",
    responsibleUAV: "20037 Mavic air",
    area: 300,
    lat: 52.156,
    lon: 20.934,
  },
  {
    clusterId: "Cluster 23455",
    coordinates: "Lat: 52.312 Lon: 21.145",
    detectionInterval: "13.02.2025 11:00 - 13:15",
    objectsType: "personnel",
    responsibleUAV: "UAV 22456",
    area: 45,
    lat: 52.312,
    lon: 21.145,
  },
  {
    clusterId: "Cluster 5533",
    coordinates: "Lat: 19.845 Lon: 175.456",
    detectionInterval: "13.02.2025 12:45 - 14:30",
    objectsType: "mixed",
    responsibleUAV: "UAV 335663",
    area: 180,
    lat: 19.845,
    lon: 175.456,
  },
  {
    clusterId: "Cluster 9876",
    coordinates: "Lat: 22.134 Lon: 181.789",
    detectionInterval: "13.02.2025 14:20 - 16:45",
    objectsType: "vehicle",
    responsibleUAV: "Kolibri 7",
    area: 65,
    lat: 22.134,
    lon: 181.789,
  },
  {
    clusterId: "Cluster 1234",
    coordinates: "Lat: 10.345 Lon: 177.834",
    detectionInterval: "13.02.2025 16:00 - 18:15",
    objectsType: "unknown",
    responsibleUAV: "20037 Mavic air",
    area: 200,
    lat: 10.345,
    lon: 177.834,
  },
  {
    clusterId: "Cluster 7890",
    coordinates: "Lat: 13.789 Lon: 186.523",
    detectionInterval: "13.02.2025 17:30 - 19:45",
    objectsType: "personnel",
    responsibleUAV: "UAV 22456",
    area: 110,
    lat: 13.789,
    lon: 186.523,
  },
  {
    clusterId: "Cluster 4567",
    coordinates: "Lat: 17.634 Lon: 174.567",
    detectionInterval: "13.02.2025 18:15 - 20:30",
    objectsType: "mixed",
    responsibleUAV: "UAV 335663",
    area: 85,
    lat: 17.634,
    lon: 174.567,
  },
  {
    clusterId: "Cluster 8901",
    coordinates: "Lat: 12.756 Lon: 184.290",
    detectionInterval: "13.02.2025 19:45 - 21:20",
    objectsType: "vehicle",
    responsibleUAV: "Kolibri 7",
    area: 140,
    lat: 12.756,
    lon: 184.29,
  },
  {
    clusterId: "Cluster 3456",
    coordinates: "Lat: 20.523 Lon: 176.189",
    detectionInterval: "13.02.2025 20:30 - 22:45",
    objectsType: "unknown",
    responsibleUAV: "20037 Mavic air",
    area: 320,
    lat: 20.523,
    lon: 176.189,
  },
  {
    clusterId: "Cluster 6789",
    coordinates: "Lat: 15.278 Lon: 182.845",
    detectionInterval: "13.02.2025 21:15 - 23:30",
    objectsType: "personnel",
    responsibleUAV: "UAV 22456",
    area: 55,
    lat: 15.278,
    lon: 182.845,
  },
  {
    clusterId: "Cluster 11234",
    coordinates: "Lat: 9.192 Lon: 179.567",
    detectionInterval: "14.02.2025 06:30 - 08:45",
    objectsType: "vehicle",
    responsibleUAV: "Kolibri 7",
    area: 95,
    lat: 9.192,
    lon: 179.567,
  },
  {
    clusterId: "Cluster 22456",
    coordinates: "Lat: 21.234 Lon: 173.623",
    detectionInterval: "14.02.2025 07:15 - 09:30",
    objectsType: "mixed",
    responsibleUAV: "UAV 22456",
    area: 160,
    lat: 21.234,
    lon: 173.623,
  },
  {
    clusterId: "Cluster 44567",
    coordinates: "Lat: 18.456 Lon: 186.734",
    detectionInterval: "14.02.2025 09:45 - 12:00",
    objectsType: "unknown",
    responsibleUAV: "UAV 335663",
    area: 280,
    lat: 18.456,
    lon: 186.734,
  },
  {
    clusterId: "Cluster 55890",
    coordinates: "Lat: 11.723 Lon: 175.156",
    detectionInterval: "14.02.2025 10:30 - 12:45",
    objectsType: "vehicle",
    responsibleUAV: "Kolibri 7",
    area: 125,
    lat: 11.723,
    lon: 175.156,
  },
  {
    clusterId: "Cluster 66123",
    coordinates: "Lat: 16.189 Lon: 184.189",
    detectionInterval: "14.02.2025 11:15 - 13:30",
    objectsType: "mixed",
    responsibleUAV: "20037 Mavic air",
    area: 190,
    lat: 16.189,
    lon: 184.189,
  },
  {
    clusterId: "Cluster 88234",
    coordinates: "Lat: 22.289 Lon: 177.623",
    detectionInterval: "14.02.2025 13:45 - 16:00",
    objectsType: "unknown",
    responsibleUAV: "UAV 335663",
    area: 240,
    lat: 22.289,
    lon: 177.623,
  },
  {
    clusterId: "Cluster 10123",
    coordinates: "Lat: 8.967 Lon: 183.734",
    detectionInterval: "14.02.2025 15:15 - 17:30",
    objectsType: "mixed",
    responsibleUAV: "20037 Mavic air",
    area: 350,
    lat: 8.967,
    lon: 183.734,
  },
];

const DetectionsSidebar: React.FC = () => {
  const [filteredDetections, setFilteredDetections] =
    useState<DetectionData[]>(allDetectionItems);

  const handleFilterChange = (filters: FilterState) => {
    let filtered = allDetectionItems;

    if (filters.type) {
      filtered = filtered.filter(
        (detection) => detection.objectsType === filters.type,
      );
    }

    if (filters.uav) {
      filtered = filtered.filter((detection) =>
        detection.responsibleUAV
          .toLowerCase()
          .includes(filters.uav.toLowerCase()),
      );
    }

    setFilteredDetections(filtered);
  };

  return (
    <div className="fixed top-[143px] left-[24px] w-[350px] h-[758px] z-10">
      {/* Header and Filter Row */}
      <div className="mb-[16px]">
        <div className="flex items-center gap-2">
          <SectionHeader
            title="Detections"
            width="w-[255px]"
            className="flex-shrink-0"
          />
          <FilterControls
            filters={[
              {
                key: "type",
                label: "Object Type",
                options: ["mixed", "vehicle", "personnel", "unknown"],
              },
              {
                key: "uav",
                label: "UAV",
                options: [
                  "UAV 22456",
                  "20037 Mavic air",
                  "UAV 335663",
                  "Kolibri 7",
                ],
              },
            ]}
            onFilterChange={handleFilterChange}
          />
        </div>
      </div>

      {/* Detection list container */}
      <div className="relative w-[350px] h-[701px] rounded-[10px] border-[1.5px] border-[rgba(211,251,216,0.5)] bg-black/60 backdrop-blur-[2px] mt-[7px]">
        {/* Scrollable content */}
        <div className="absolute left-[17px] top-[20px] w-[316px] h-[670px] flex flex-col items-start overflow-y-auto pr-2">
          <div className="flex flex-col items-start w-[283px]">
            {filteredDetections.map((item, index) => (
              <DetectionItem
                key={index}
                clusterId={item.clusterId}
                coordinates={item.coordinates}
                detectionInterval={item.detectionInterval}
                objectsType={item.objectsType}
                responsibleUAV={item.responsibleUAV}
              />
            ))}
          </div>
        </div>

        {/* Scrollbar indicator */}
        <div className="w-1 h-[143px] rounded-[3px] opacity-30 bg-white absolute right-3 top-[15px]"></div>

        {/* Bottom gradient overlay */}
        <div className="w-[264px] h-[86px] rounded-[10px] bg-gradient-to-b from-transparent to-black mix-blend-darken absolute left-[2px] bottom-0"></div>
      </div>
    </div>
  );
};

export default DetectionsSidebar;
